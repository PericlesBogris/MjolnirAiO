<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <link rel="stylesheet" href="{{ url_for('static',filename='style.css') }}">
    <meta charset="utf-8">
    <title>Mjolnir AiO Tool</title>
    <link rel="icon" href="https://i.ibb.co/f49G2GL/Spotify-Logo.png">
  </head>
  <body>
    <div id="mySidenav" class="sidenav">
      <a href="http://mjolnir.tool/generator">Generator</a>
      <a href="http://mjolnir.tool/streamer">Streamer</a>
      <a href="http://mjolnir.tool/liker">Liker</a>
      <a href="http://mjolnir.tool/checker">Checker</a>
      <a href="http://mjolnir.tool/combo">ComboEditor</a>
      <a href="https://github.com/Vinyzu/MjolnirAiO/" style="position: absolute; bottom: 40px; font-size: 20px;">Coded by Vinyzu</a>
    </div>
    <div class="title">
      <h1>Streamer</h1>
      <a href="https://github.com/Vinyzu/MjolnirAiO/" style="margin: auto; width: 95%; position: absolute; bottom: 22px; font-size: 20px;">If you paid for this, you got scammed!</a>
    </div>
    <div class="selection">
      <br><br>
      <input type="submit" value="Desktop Streamer" id="desktop"><br><br>
      <input type="submit" value="Web Streamer" id="web"><br><br>
    </div>
    <div class="content">
      <label for="amount" style="font-size: 15px; color: #545454;">Desktop-Streamer</label><br><br>
      <br><br>
      <label for="amount">Links:   </label><input type="text" id="link" name="link" value=""><br>
      <label for="amount" style="font-size: 15px; color: #545454;">URLs(Seperated by ",")/FilePath</label><br><br>
      <label for="threads">Threads:   </label><input type="text" id="threads" name="threads" value="10" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0[^.]/, '0');"><br><br>
      <label for="threads">Maximal Streaming Time:   </label><input type="text" id="max" name="max" value="5" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0[^.]/, '0');"><br>
      <label for="amount" style="font-size: 15px; color: #545454;">In Minutes</label><br><br>
      <label for="threads">Stream from Position:   </label><input type="text" id="pos" name="pos" value="0" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0[^.]/, '0');"><br><br>
      <!-- <label for="threads">Like while Streaming:   </label>
      <label class="switch"><input type="checkbox" id="like-switch"><span class="slider round"></span></label><br><br> -->
      <label for="amount">Like Probability:   </label><input type="text" id="like" name="like" value="50" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0[^.]/, '0');"><br>
      <label for="amount" style="font-size: 15px; color: #545454;">In Percent (%)</label><br><br>
      <!-- <label for="amount">Follow Probability (%):   </label><input type="text" id="follow" name="like" value="50"><br><br> -->
      <label for="threads">Mute Audio:   </label>
      <label class="switch"><input type="checkbox" id="mute"><span class="slider round"></span></label><br><br>
      <label for="threads">Use Proxies:   </label>
      <label class="switch"><input type="checkbox" id="proxy-switch"><span class="slider round"></span></label><br><br>
      <label for="threads">Use a Webhook:   </label>
      <label class="switch"><input type="checkbox" id="webhook-switch"><span class="slider round"></span></label><br><br>
      <label for="amount">Combo Path:   </label><input type="text" id="combo" name="combo" value=""><br><br>
      <input type="submit" value="Submit" id="submit"><br><br>
      <input type="file" id="logo">
      <br><br>
      <label for="logs" id="logs">Logs:</label><br><br>
      <textarea id="textarea" name="textarea" rows="4" cols="50" readonly></textarea>
    </div>
    <div class="content">
      <label for="amount" style="font-size: 15px; color: #545454;">Web-Streamer</label><br><br>
      <br><br>
      <label for="amount">Links:   </label><input type="text" id="r_link" name="link" value=""><br>
      <label for="amount" style="font-size: 15px; color: #545454;">URLs(Seperated by ",")/FilePath</label><br><br>
      <label for="threads">Threads:   </label><input type="text" id="r_threads" name="r_threads" value="10" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0[^.]/, '0');"><br><br>
      <label for="threads">Maximal Streaming Time:   </label><input type="text" id="r_max" name="r_max" value="5" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0[^.]/, '0');"><br>
      <label for="amount" style="font-size: 15px; color: #545454;">In Minutes</label><br><br>
      <label for="threads">Stream from Position:   </label><input type="text" id="r_pos" name="r_pos" value="0" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0[^.]/, '0');"><br><br>
      <!-- <label for="threads">Like while Streaming:   </label>
      <label class="switch"><input type="checkbox" id="r_like-switch"><span class="slider round"></span></label><br><br> -->
      <label for="amount">Like Probability:   </label><input type="text" id="r_like" name="like" value="50" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0[^.]/, '0');"><br>
      <label for="amount" style="font-size: 15px; color: #545454;">In Percent (%)</label><br><br>
      <!-- <label for="amount">Follow Probability (%):   </label><input type="text" id="r_follow" name="like" value="50"><br><br> -->
      <label for="threads">Time between Streams:   </label><input type="text" id="r_timeout" name="r_timeout" value="5" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0[^.]/, '0');"><br>
      <label for="amount" style="font-size: 15px; color: #545454;">In Minutes</label><br><br>
      <label for="threads">Use Proxies:   </label>
      <label class="switch"><input type="checkbox" id="r_proxy-switch"><span class="slider round"></span></label><br><br>
      <!-- <div class="proxy-select", id="div-proxy-select">
        <label for="gender">Select a Proxy-Type:   </label>
          <select name="proxy" id="proxy-select">
            <option value="residential">Residential</option>
            <option value="datacenter">Datacenter</option>
          </select><br><br>
      </div> -->
      <label for="amount">Combo Path:   </label><input type="text" id="r_combo" name="r_combo" value=""><br><br>
      <input type="submit" value="Submit" id="r_submit"><br><br>
      <input type="file" id="r_logo">
      <br><br>
      <label for="logs" id="r_logs">Logs:</label><br><br>
      <textarea id="r_textarea" name="r_textarea" rows="4" cols="50" readonly></textarea>
    </div>
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script>
    $("#textarea").css('opacity','0');
    $("#logs").css('opacity','0');
    window.setInterval(function() {var elem = document.getElementById('textarea'); elem.scrollTop = elem.scrollHeight;}, 1000);
    $("#r_textarea").css('opacity','0');
    $("#r_logs").css('opacity','0');
    window.setInterval(function() {var elem = document.getElementById('r_textarea'); elem.scrollTop = elem.scrollHeight;}, 1000);
    var proxies = "";
    $("#logo").css('opacity','0');
    document.getElementById("proxy-switch").onclick = function(e){if (! document.getElementById("proxy-switch").checked) {document.getElementById("proxy-switch").checked = false; proxies = "";} else {$("#logo").trigger('click');}};
    $('#logo').change( function(event) {
      var tmppath = URL.createObjectURL(event.target.files[0]); var xhr = new XMLHttpRequest(); xhr.open('GET', tmppath, true); xhr.responseType = 'blob';
      xhr.onload = function(e) {if (this.status == 200) {var blob = this.response; var myReader = new FileReader(); myReader.addEventListener("loadend", function(e){proxies = e.srcElement.result;}); myReader.readAsText(blob);}};
      xhr.send();});

    var webhook = "";
    document.getElementById("webhook-switch").onclick = function(e){
      if (! document.getElementById("webhook-switch").checked) {
        console.log("bad");
        document.getElementById("webhook-switch").checked = false; webhook = "";
      } else {
        console.log("good");
        var url = prompt("Please enter your webhook:", "");
        if (! url.includes("https")) {
          alert("The Webhook-Url was invalid!");
          document.getElementById("webhook-switch").checked = false;
        } else {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'json';
        xhr.onload  = function(e) {console.log(xhr.response);
        if(xhr.response.hasOwnProperty('message')){alert("The Webhook-Url was invalid!"); document.getElementById("webhook-switch").checked = false;
          } else {webhook = url;}}
        xhr.send();
      }}};
    document.getElementById("submit").onclick = function(e){
      $.ajax({
        type: "POST",
        url: "{{ url_for("dstream") }}",
        contentType: "application/json",
        data: JSON.stringify({
          link: document.getElementById("link").value,
          threads: document.getElementById("threads").value,
          max: document.getElementById("max").value,
          pos: document.getElementById("pos").value,
          like: document.getElementById("like").value,
          // follow: document.getElementById("follow").value,
          mute: document.getElementById("mute").checked,
          proxies: proxies,
          webhook: webhook,
          path: document.getElementById("combo").value,
        }),
        success: function(res) {
          console.log(res);
          const socket = new WebSocket(res);
          socket.addEventListener('open', () => {
              console.log('Connection established');
                socket.send("Update");
              }
          );
          socket.addEventListener('message', event => {
              console.log('Message from server ', event.data);
              document.getElementById('textarea').value += event.data + "\r\n";
              // document.getElementById('textarea').value = event.data;
              $("#textarea").css('opacity','100');
              $("#logs").css('opacity','100');
          });
        },
        error: function(err) {
            console.log(err);
        }
    });
    }
    document.getElementsByClassName("content")[0].style.display = 'none';
    document.getElementsByClassName("content")[1].style.display = 'none';
    document.getElementById("desktop").onclick = function(e) {document.getElementsByClassName("content")[0].style.display = 'block'; document.getElementsByClassName("selection")[0].style.display = 'none';}
    document.getElementById("web").onclick = function(e) {document.getElementsByClassName("content")[1].style.display = 'block'; document.getElementsByClassName("selection")[0].style.display = 'none';}



    var r_proxies = "";
    $("#r_logo").css('opacity','0');
    document.getElementsByClassName("proxy-select")[0].style.display = 'none';
    document.getElementById("r_proxy-switch").onclick = function(e){if (! document.getElementById("r_proxy-switch").checked) {document.getElementById("r_proxy-switch").checked = false; proxies = "";} else {$("#r_logo").trigger('click');}};
    $('#r_logo').change( function(event) {
      var tmppath = URL.createObjectURL(event.target.files[0]); var xhr = new XMLHttpRequest(); xhr.open('GET', tmppath, true); xhr.responseType = 'blob';
      xhr.onload = function(e) {if (this.status == 200) {var blob = this.response; var myReader = new FileReader(); myReader.addEventListener("loadend", function(e){r_proxies = e.srcElement.result;}); myReader.readAsText(blob);}};
      xhr.send();
      document.getElementsByClassName("proxy-select")[0].style.display = 'block';});

      document.getElementById("r_submit").onclick = function(e){
        $.ajax({
          type: "POST",
          url: "{{ url_for("wstream") }}",
          contentType: "application/json",
          data: JSON.stringify({
            link: document.getElementById("r_link").value,
            threads: document.getElementById("r_threads").value,
            max: document.getElementById("r_max").value,
            pos: document.getElementById("r_pos").value,
            timeout: document.getElementById("r_timeout").value,
            like: document.getElementById("r_like").value,
            // follow: document.getElementById("r_follow").value,
            proxies: r_proxies,
            path: document.getElementById("r_combo").value,
          }),
          success: function(res) {
            console.log(res);
            const socket = new WebSocket(res);
            socket.addEventListener('open', () => {
                console.log('Connection established');
                  socket.send("Update");
                }
            );
            socket.addEventListener('message', event => {
                console.log('Message from server ', event.data);
                document.getElementById('r_textarea').value += event.data + "\r\n";
                // document.getElementById('textarea').value = event.data;
                $("#r_textarea").css('opacity','100');
                $("#r_logs").css('opacity','100');
            });
          },
          error: function(err) {
              console.log(err);
          }
      });
      }
    </script>
</html>
